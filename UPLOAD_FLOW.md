# CKEditor Supabase Upload Flow

## Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Django Admin                             â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    Blog Post Editor                       â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚           CKEditor 5 Rich Text Editor             â”‚   â”‚  â”‚
â”‚  â”‚  â”‚                                                    â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  [B] [I] [U] [ğŸ–¼ï¸ Image Upload] [Link] [...]      â”‚   â”‚  â”‚
â”‚  â”‚  â”‚                                                    â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  User clicks image upload button â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”˜   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                  â”‚
                                                  â”‚ 1. POST /upload/ckeditor/
                                                  â”‚    multipart/form-data
                                                  â”‚    Field: upload (file)
                                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Django Backend                              â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  URL: /upload/ckeditor/                                   â”‚  â”‚
â”‚  â”‚  View: blog/views_ckeditor5_upload.py                     â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  1. Check Authentication (@staff_member_required)  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     â”œâ”€ Not admin? â†’ 403 Forbidden                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     â””â”€ Admin? â†’ Continue                           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  2. Validate File Type                             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     â”œâ”€ Not image? â†’ 400 Bad Request                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     â””â”€ Valid? â†’ Continue                           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  3. Validate File Size                             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     â”œâ”€ > 5MB? â†’ 400 Bad Request                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     â””â”€ Valid? â†’ Continue                           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  4. Call supabase_storage.upload_file()            â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                          â”‚ 2. Upload file
                                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Supabase Storage Client                        â”‚
â”‚                   (core/storage.py)                              â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  SupabaseStorage Class                                    â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  1. Generate unique filename (UUID + extension)          â”‚  â”‚
â”‚  â”‚     Example: 3f8a9b2c-4d5e-6f7g-8h9i-0j1k2l3m4n5o.jpg   â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  2. Create path: blog/images/{uuid}.jpg                  â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  3. Upload via Supabase client:                          â”‚  â”‚
â”‚  â”‚     client.storage.from_(bucket).upload(path, content)   â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  4. Generate public URL:                                 â”‚  â”‚
â”‚  â”‚     client.storage.from_(bucket).get_public_url(path)    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                          â”‚ 3. Store file
                                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Supabase Cloud                              â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Storage Bucket: leather_api_storage                      â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  blog/                                                     â”‚  â”‚
â”‚  â”‚  â””â”€â”€ images/                                              â”‚  â”‚
â”‚  â”‚      â”œâ”€â”€ 3f8a9b2c-4d5e-6f7g-8h9i-0j1k2l3m4n5o.jpg        â”‚  â”‚
â”‚  â”‚      â”œâ”€â”€ 7a1b2c3d-4e5f-6g7h-8i9j-0k1l2m3n4o5p.png        â”‚  â”‚
â”‚  â”‚      â””â”€â”€ ...                                              â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  Public URL Generated:                                    â”‚  â”‚
â”‚  â”‚  https://xyz.supabase.co/storage/v1/object/public/       â”‚  â”‚
â”‚  â”‚  leather_api_storage/blog/images/{uuid}.jpg               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                          â”‚ 4. Return public URL
                                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Django Response                             â”‚
â”‚                                                                   â”‚
â”‚  JSON Response:                                                  â”‚
â”‚  {                                                               â”‚
â”‚    "url": "https://xyz.supabase.co/storage/v1/object/public/    â”‚
â”‚            leather_api_storage/blog/images/uuid.jpg"             â”‚
â”‚  }                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                          â”‚ 5. Insert URL into editor
                                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CKEditor 5                               â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Content:                                                 â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  <p>This is my blog post...</p>                           â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  <img src="https://xyz.supabase.co/storage/v1/object/    â”‚  â”‚
â”‚  â”‚       public/leather_api_storage/blog/images/uuid.jpg"    â”‚  â”‚
â”‚  â”‚       alt="Uploaded image">                               â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  <p>More content...</p>                                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Request/Response Flow

### 1. Upload Request

```http
POST /upload/ckeditor/ HTTP/1.1
Host: localhost:8000
Cookie: sessionid=abc123...
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary

------WebKitFormBoundary
Content-Disposition: form-data; name="upload"; filename="photo.jpg"
Content-Type: image/jpeg

[binary image data]
------WebKitFormBoundary--
```

### 2. Success Response

```http
HTTP/1.1 200 OK
Content-Type: application/json

{
  "url": "https://soccrpfkqjqjaoaturjb.supabase.co/storage/v1/object/public/leather_api_storage/blog/images/3f8a9b2c-4d5e-6f7g-8h9i-0j1k2l3m4n5o.jpg"
}
```

### 3. Error Response (Invalid File Type)

```http
HTTP/1.1 400 Bad Request
Content-Type: application/json

{
  "error": {
    "message": "Invalid file type. Allowed: image/jpeg, image/png, image/gif, image/webp, image/jpg"
  }
}
```

### 4. Error Response (Not Authenticated)

```http
HTTP/1.1 403 Forbidden
Content-Type: text/html

[Django login redirect]
```

## Security Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 1: Django Authentication                         â”‚
â”‚  â”œâ”€ @staff_member_required decorator                    â”‚
â”‚  â””â”€ Only admin/staff users can access                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 2: File Type Validation                          â”‚
â”‚  â”œâ”€ Whitelist: JPEG, PNG, GIF, WebP                     â”‚
â”‚  â””â”€ Reject all other file types                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 3: File Size Validation                          â”‚
â”‚  â”œâ”€ Maximum: 5MB                                         â”‚
â”‚  â””â”€ Reject larger files                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 4: Unique Filename Generation                    â”‚
â”‚  â”œâ”€ UUID-based filenames                                 â”‚
â”‚  â””â”€ Prevents overwrites and conflicts                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 5: Supabase Authentication                       â”‚
â”‚  â”œâ”€ Service role key required                            â”‚
â”‚  â””â”€ Bucket-level permissions                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## File Storage Structure

```
Supabase Storage
â””â”€â”€ leather_api_storage (bucket)
    â””â”€â”€ blog/
        â””â”€â”€ images/
            â”œâ”€â”€ 3f8a9b2c-4d5e-6f7g-8h9i-0j1k2l3m4n5o.jpg
            â”œâ”€â”€ 7a1b2c3d-4e5f-6g7h-8i9j-0k1l2m3n4o5p.png
            â”œâ”€â”€ 9b2c3d4e-5f6g-7h8i-9j0k-1l2m3n4o5p6q.webp
            â””â”€â”€ ...

Public URLs:
https://soccrpfkqjqjaoaturjb.supabase.co/storage/v1/object/public/leather_api_storage/blog/images/{uuid}.{ext}
```

## Code Flow

```python
# 1. User uploads image in CKEditor
# CKEditor sends POST to /upload/ckeditor/

# 2. Django view receives request
@csrf_exempt
@staff_member_required
def ckeditor5_upload(request):
    file = request.FILES.get('upload')
    
    # 3. Validate file
    if file.content_type not in ALLOWED_IMAGE_TYPES:
        return JsonResponse({'error': {...}}, status=400)
    
    if file.size > MAX_FILE_SIZE:
        return JsonResponse({'error': {...}}, status=400)
    
    # 4. Upload to Supabase
    url = supabase_storage.upload_file(file, folder='blog/images/')
    
    # 5. Return URL to CKEditor
    return JsonResponse({'url': url})

# 6. CKEditor inserts image with URL
# <img src="https://...supabase.co/.../uuid.jpg">
```

## Configuration Chain

```
.env file
    â†“
settings.py
    â†“ SUPABASE_URL, SUPABASE_API_KEY, SUPABASE_BUCKET
core/storage.py (SupabaseStorage)
    â†“ supabase_storage singleton
blog/views_ckeditor5_upload.py
    â†“ ckeditor5_upload view
leather_api/urls.py
    â†“ /upload/ckeditor/ endpoint
CKEditor Config (settings.py)
    â†“ simpleUpload.uploadUrl
CKEditor in Django Admin
```

## Summary

1. **User Action:** Clicks image upload in CKEditor
2. **Request:** POST to `/upload/ckeditor/` with file
3. **Validation:** Auth, file type, file size
4. **Upload:** File sent to Supabase Storage
5. **Storage:** File saved with UUID filename
6. **Response:** Public URL returned to CKEditor
7. **Display:** Image inserted into editor with URL
8. **Save:** Post saved with Supabase image URLs in content

**Result:** All images stored in Supabase cloud, served via CDN, no local storage needed.
